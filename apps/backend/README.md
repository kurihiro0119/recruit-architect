# Backend API

Recruit Architect ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API å®Ÿè£…ã€‚Hono + Cloudflare Workers + D1 ã§æ§‹ç¯‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
apps/backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                    # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ routes/                      # HTTPãƒ¬ã‚¤ãƒ¤ï¼ˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
â”‚   â”‚   â”œâ”€â”€ base.routes.ts          # CRUDãƒ«ãƒ¼ãƒˆç”Ÿæˆãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚   â”‚   â”œâ”€â”€ kpi.routes.ts           # KPIé–¢é€£ãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ initiative.routes.ts
â”‚   â”‚   â”œâ”€â”€ services/               # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”‚   â”œâ”€â”€ base.service.ts         # ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆå…±é€šCRUDï¼‰
â”‚   â”‚   â”œâ”€â”€ kpi.service.ts          # KPIã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”œâ”€â”€ initiative.service.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ adapters/                    # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
â”‚       â””â”€â”€ d1-db.ts                # D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼
â”œâ”€â”€ migrations/                      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â””â”€â”€ 0001_initial.sql
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ wrangler.toml                    # Cloudflare Workersè¨­å®š
```

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ¬ã‚¤ãƒ¤æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTP Request                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   index.ts                          â”‚
â”‚   - ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¨­å®š                 â”‚
â”‚   - ãƒ«ãƒ¼ãƒˆç™»éŒ²                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   routes/                           â”‚
â”‚   - HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†    â”‚
â”‚   - Zodã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³  â”‚
â”‚   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   services/                         â”‚
â”‚   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯                â”‚
â”‚   - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ¶å¾¡            â”‚
â”‚   - è¤‡æ•°ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å”èª¿å‡¦ç†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   adapters/                         â”‚
â”‚   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹            â”‚
â”‚   - å¤–éƒ¨APIå‘¼ã³å‡ºã—                 â”‚
â”‚   - ãƒ‡ãƒ¼ã‚¿å¤‰æ›ï¼ˆcamelCase â†” snake_caseï¼‰â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Cloudflare D1 Database             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ API å‘¼ã³å‡ºã—ã®æµã‚Œ

### ä¾‹: `GET /api/kpis` ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡
   â†“
2. index.ts
   - logger() ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒ­ã‚°å‡ºåŠ›
   - cors() ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢: CORSãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
   â†“
3. routes/kpi.routes.ts
   - registerKpiRoutes() ã§ç™»éŒ²ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã«ãƒãƒƒãƒ
   - base.routes.ts ã® createCrudRoutes() ã§ç”Ÿæˆã•ã‚ŒãŸ GET ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒå®Ÿè¡Œ
   â†“
4. routes/base.routes.ts
   - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—
   - ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆ: new KpiService(c.env.DB)
   â†“
5. services/kpi.service.ts
   - getAll() ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—
   - BaseService ã® getAll() ãŒå®Ÿè¡Œã•ã‚Œã‚‹
   â†“
6. services/base.service.ts
   - getRepository() ã§ D1Service ã‚’å–å¾—
   - repository.getAll() ã‚’å‘¼ã³å‡ºã—
   â†“
7. adapters/d1-db.ts
   - createD1Service() ã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸãƒªãƒã‚¸ãƒˆãƒªã‚’ç”Ÿæˆ
   - SQLã‚¯ã‚¨ãƒªå®Ÿè¡Œ: SELECT * FROM kpis ORDER BY created_at DESC
   - fromDbRecord() ã§ snake_case â†’ camelCase ã«å¤‰æ›
   - JSONãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒ‘ãƒ¼ã‚¹ï¼ˆcomments ãªã©ï¼‰
   â†“
8. ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´
   - services â†’ routes â†’ index.ts ã®é †ã§æˆ»ã‚‹
   - c.json(items) ã§ JSON ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´
```

### ä¾‹: `POST /api/kpis` ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ä»˜ãï¼‰
   â†“
2. index.tsï¼ˆãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å‡¦ç†ï¼‰
   â†“
3. routes/kpi.routes.ts
   - POST ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒå®Ÿè¡Œ
   â†“
4. routes/base.routes.ts
   - c.req.json() ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’å–å¾—
   - CreateKpiSchema.safeParse() ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•— â†’ 400ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ â†’ ã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã³å‡ºã—
   â†“
5. services/kpi.service.ts
   - create() ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—
   â†“
6. services/base.service.ts
   - repository.create() ã‚’å‘¼ã³å‡ºã—
   â†“
7. adapters/d1-db.ts
   - UUIDç”Ÿæˆï¼ˆidï¼‰
   - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç”Ÿæˆï¼ˆcreatedAt, updatedAtï¼‰
   - toDbRecord() ã§ camelCase â†’ snake_case ã«å¤‰æ›
   - JSONãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ–‡å­—åˆ—åŒ–ï¼ˆcomments ãªã©ï¼‰
   - SQLå®Ÿè¡Œ: INSERT INTO kpis (...)
   - å±¥æ­´ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ ï¼ˆhistory ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
   - fromDbRecord() ã§å¤‰æ›ã—ã¦è¿”å´
   â†“
8. ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´
   - 201 Created ã§ä½œæˆã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è¿”å´
```

## ğŸ“ å„ãƒ¬ã‚¤ãƒ¤ã®è²¬å‹™

### `index.ts` (ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ)

- Hono ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
- ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¨­å®šï¼ˆlogger, corsï¼‰
- å…¨ãƒ«ãƒ¼ãƒˆã®ç™»éŒ²
- Cloudflare Workers ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**ä¸»ãªå‡¦ç†:**

```typescript
const app = new Hono<{ Bindings: Env }>();
app.use("*", logger());
app.use("*", cors({ ... }));
registerKpiRoutes(app);
registerInitiativeRoutes(app);
// ... ä»–ã®ãƒ«ãƒ¼ãƒˆã‚‚ç™»éŒ²
export default app;
```

### `routes/` (HTTP ãƒ¬ã‚¤ãƒ¤)

**è²¬å‹™:**

- HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‡¦ç†
- ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ãƒ‘ãƒ¼ã‚¹
- Zod ã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨é©åˆ‡ãª HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®è¿”å´
- ã‚µãƒ¼ãƒ“ã‚¹ã®å‘¼ã³å‡ºã—

**ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ:**

- `base.routes.ts`: CRUD ãƒ«ãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹æ±ç”¨é–¢æ•°
- `{entity}.routes.ts`: å„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ«ãƒ¼ãƒˆç™»éŒ²é–¢æ•°

**ä¾‹: `routes/kpi.routes.ts`**

```typescript
export function registerKpiRoutes(app: Hono<{ Bindings: Env }>) {
  createCrudRoutes<Kpi>(
    app,
    "/api/kpis",
    (db) => new KpiService(db),
    CreateKpiSchema, // ä½œæˆæ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    UpdateKpiSchema, // æ›´æ–°æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    "KPI"
  );
}
```

### `services/` (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤)

**è²¬å‹™:**

- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…
- è¤‡æ•°ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã¾ãŸãŒã‚‹å‡¦ç†ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³åˆ¶å¾¡ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
- AI å‡¦ç†ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ:**

- `base.service.ts`: å…±é€š CRUD æ“ä½œã‚’æä¾›ã™ã‚‹æŠ½è±¡ã‚¯ãƒ©ã‚¹
- `{entity}.service.ts`: å„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆç¾çŠ¶ã¯ BaseService ã‚’ç¶™æ‰¿ï¼‰

**ä¾‹: `services/kpi.service.ts`**

```typescript
export class KpiService extends BaseService<Kpi> {
  constructor(db: D1Database) {
    super(db, "kpi");
  }

  // å°†æ¥çš„ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ å¯èƒ½
  // ä¾‹: async getByPeriod(period: string): Promise<Kpi[]>
}
```

**BaseService ã®ãƒ¡ã‚½ãƒƒãƒ‰:**

- `getAll()`: å…¨ä»¶å–å¾—
- `getById(id)`: ID æŒ‡å®šå–å¾—
- `create(data)`: ä½œæˆ
- `update(id, data)`: æ›´æ–°
- `delete(id)`: å‰Šé™¤

### `adapters/` (ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤)

**è²¬å‹™:**

- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹
- ãƒ‡ãƒ¼ã‚¿å½¢å¼ã®å¤‰æ›ï¼ˆcamelCase â†” snake_caseï¼‰
- JSON ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º/ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
- å±¥æ­´ç®¡ç†ï¼ˆhistory ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®è¨˜éŒ²ï¼‰

**ä¸»ãªæ©Ÿèƒ½:**

1. **ãƒ‡ãƒ¼ã‚¿å¤‰æ›**

   - `toDbRecord()`: camelCase â†’ snake_caseï¼ˆDB ä¿å­˜æ™‚ï¼‰
   - `fromDbRecord()`: snake_case â†’ camelCaseï¼ˆDB å–å¾—æ™‚ï¼‰
   - JSON ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è‡ªå‹•å‡¦ç†ï¼ˆcomments, revisions ãªã©ï¼‰

2. **ãƒªãƒã‚¸ãƒˆãƒªç”Ÿæˆ**

   - `createD1Service<T>()`: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸãƒªãƒã‚¸ãƒˆãƒªã‚’ç”Ÿæˆ
   - ãƒ†ãƒ¼ãƒ–ãƒ«åã¨ JSON ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¨­å®šã‚’ç®¡ç†

3. **å±¥æ­´ç®¡ç†**
   - `addHistoryEntry()`: ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ã®å±¥æ­´ã‚’è¨˜éŒ²
   - `getHistory()`: å±¥æ­´ã‚’å–å¾—

## ğŸ”Œ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ              | ãƒ¡ã‚½ãƒƒãƒ‰            | èª¬æ˜                                     |
| --------------------------- | ------------------- | ---------------------------------------- |
| `/`                         | GET                 | API æƒ…å ±å–å¾—                             |
| `/api/kpis`                 | GET                 | KPI ä¸€è¦§å–å¾—                             |
| `/api/kpis/:id`             | GET                 | KPI è©³ç´°å–å¾—                             |
| `/api/kpis`                 | POST                | KPI ä½œæˆ                                 |
| `/api/kpis/:id`             | PUT                 | KPI æ›´æ–°                                 |
| `/api/kpis/:id`             | DELETE              | KPI å‰Šé™¤                                 |
| `/api/initiatives`          | GET/POST/PUT/DELETE | æ–½ç­–ç®¡ç†                                 |
| `/api/company-analyses`     | GET/POST/PUT/DELETE | ä¼æ¥­åˆ†æ                                 |
| `/api/job-postings`         | GET/POST/PUT/DELETE | æ±‚äººæƒ…å ±                                 |
| `/api/job-roles`            | GET/POST/PUT/DELETE | è·å‹™å®šç¾©                                 |
| `/api/competitor-jobs`      | GET/POST/PUT/DELETE | ç«¶åˆæ±‚äºº                                 |
| `/api/organizations`        | GET/POST/PUT/DELETE | çµ„ç¹”æƒ…å ±                                 |
| `/api/selection-processes`  | GET/POST/PUT/DELETE | é¸è€ƒãƒ—ãƒ­ã‚»ã‚¹                             |
| `/api/recruitment-channels` | GET/POST/PUT/DELETE | æ¡ç”¨ãƒãƒ£ãƒãƒ«                             |
| `/api/faqs`                 | GET/POST/PUT/DELETE | FAQ                                      |
| `/api/history`              | GET                 | å±¥æ­´å–å¾—ï¼ˆã‚¯ã‚¨ãƒª: entityId, entityTypeï¼‰ |

## ğŸ› ï¸ é–‹ç™º

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install

# å‹ãƒã‚§ãƒƒã‚¯
pnpm typecheck

# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pnpm dev
```

### æ–°ã—ã„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®è¿½åŠ æ‰‹é †

1. **ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®è¿½åŠ **

   ```typescript
   // services/new-entity.service.ts
   export class NewEntityService extends BaseService<NewEntity> {
     constructor(db: D1Database) {
       super(db, "newEntity");
     }
   }
   ```

2. **ãƒ«ãƒ¼ãƒˆå±¤ã®è¿½åŠ **

   ```typescript
   // routes/new-entity.routes.ts
   export function registerNewEntityRoutes(app: Hono<{ Bindings: Env }>) {
     createCrudRoutes<NewEntity>(
       app,
       "/api/new-entities",
       (db) => new NewEntityService(db),
       CreateNewEntitySchema,
       UpdateNewEntitySchema,
       "New Entity"
     );
   }
   ```

3. **index.ts ã«ç™»éŒ²**

   ```typescript
   import { registerNewEntityRoutes } from "./routes/new-entity.routes";
   // ...
   registerNewEntityRoutes(app);
   ```

4. **adapters/d1-db.ts ã«è¨­å®šè¿½åŠ **
   ```typescript
   const tableConfigs = {
     // ...
     newEntity: { tableName: "new_entities", jsonFields: ["comments"] },
   };
   ```

## ğŸ” å‹å®‰å…¨æ€§

- **OpenAPI ã‚¹ã‚­ãƒ¼ãƒ**: `@recruit-architect/openapi` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‹ã‚‰å‹ã¨ Zod ã‚¹ã‚­ãƒ¼ãƒã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- **å‹æ¨è«–**: TypeScript ã®ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¿ã‚¤ãƒ—ã‚’ä¿æŒ
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Zod ã‚¹ã‚­ãƒ¼ãƒã§å®Ÿè¡Œæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

- **Cloudflare D1**: SQLite ãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **å‘½åè¦å‰‡**: ãƒ†ãƒ¼ãƒ–ãƒ«åã¯ snake_caseã€ã‚«ãƒ©ãƒ åã‚‚ snake_case
- **JSON ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: é…åˆ—ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ JSON æ–‡å­—åˆ—ã¨ã—ã¦ä¿å­˜
- **å±¥æ­´ç®¡ç†**: ã™ã¹ã¦ã®å¤‰æ›´ãŒ `history` ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¨˜éŒ²ã•ã‚Œã‚‹

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã® DB

`pnpm dev` ã§ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã¨ã€**wrangler ãŒè‡ªå‹•çš„ã«ãƒ­ãƒ¼ã‚«ãƒ« D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆãƒ»ç®¡ç†**ã—ã¾ã™ã€‚

**å‹•ä½œ:**

1. `wrangler dev` å®Ÿè¡Œæ™‚ã«ã€ãƒ­ãƒ¼ã‚«ãƒ« D1 ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒèµ·å‹•
2. `migrations/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã® SQL ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•çš„ã«é©ç”¨ã•ã‚Œã‚‹
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.wrangler/state/v3/d1/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã‚‹ï¼ˆé€šå¸¸ã¯ `.gitignore` ã«å«ã¾ã‚Œã‚‹ï¼‰
4. ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•æ™‚ã‚‚ã€åŒã˜ãƒ­ãƒ¼ã‚«ãƒ« DB ãŒä½¿ç”¨ã•ã‚Œã‚‹ï¼ˆãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã‚‹ï¼‰

**è¨­å®š (`wrangler.toml`):**

```toml
[[d1_databases]]
binding = "DB"
database_name = "recruit-architect-db"
database_id = "local"  # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã¯ "local" ã‚’æŒ‡å®š
migrations_dir = "migrations"
```

**ãƒ­ãƒ¼ã‚«ãƒ« DB ã®ãƒªã‚»ãƒƒãƒˆ:**

```bash
# .wrangler ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ã™ã‚‹ã¨ã€æ¬¡å›èµ·å‹•æ™‚ã«æ–°ã—ã„DBãŒä½œæˆã•ã‚Œã‚‹
rm -rf .wrangler
pnpm dev
```

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¢ºèª:**

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«DBã®çŠ¶æ…‹ã‚’ç¢ºèªï¼ˆwrangler devå®Ÿè¡Œä¸­ã«åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ï¼‰
npx wrangler d1 execute recruit-architect-db --local --command "SELECT name FROM sqlite_master WHERE type='table';"
```

**æ³¨æ„:**

- ãƒ­ãƒ¼ã‚«ãƒ« DB ã¯é–‹ç™ºç”¨ã® SQLite ãƒ•ã‚¡ã‚¤ãƒ«ã§ã€æœ¬ç•ªç’°å¢ƒã¨ã¯å®Œå…¨ã«åˆ†é›¢ã•ã‚Œã¦ã„ã‚‹
- ãƒ­ãƒ¼ã‚«ãƒ«ã§ä½œæˆã—ãŸãƒ‡ãƒ¼ã‚¿ã¯æœ¬ç•ªç’°å¢ƒã«ã¯åæ˜ ã•ã‚Œãªã„
- è¤‡æ•°ã®é–‹ç™ºè€…ãŒåŒã˜ãƒ­ãƒ¼ã‚«ãƒ« DB ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ã¯ãªã„ï¼ˆå„ãƒã‚·ãƒ³ã«ç‹¬ç«‹ã—ãŸ DB ãŒä½œæˆã•ã‚Œã‚‹ï¼‰

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ãƒ“ãƒ«ãƒ‰
pnpm build

# ãƒ‡ãƒ—ãƒ­ã‚¤
pnpm deploy
```

## ğŸ“š å‚è€ƒ

- [Hono Documentation](https://hono.dev/)
- [Cloudflare Workers Documentation](https://developers.cloudflare.com/workers/)
- [Cloudflare D1 Documentation](https://developers.cloudflare.com/d1/)
